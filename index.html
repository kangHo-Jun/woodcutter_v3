<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1A1A1A">
    <title>ÎåÄÏû•Í∞Ñ V3</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Unified Header -->
        <header class="app-header">
            <h1 class="logo">ÎåÄÏû•Í∞Ñ <span class="v-badge">V3</span></h1>
            <nav class="step-nav">
                <span class="nav-item active" data-step="1">ÏÑ§Ï†ï</span>
                <span class="nav-separator">¬∑</span>
                <span class="nav-item" data-step="2">ÏûÖÎ†•</span>
                <span class="nav-separator">¬∑</span>
                <span class="nav-item" data-step="3">Í≤∞Í≥º</span>
            </nav>
        </header>

        <!-- Step 1: Board Settings -->
        <section class="screen active" id="step1">
            <div class="screen-content">
                <div class="setting-group-main">
                    <h2 class="section-title">ÏõêÌåê ÌÅ¨Í∏∞</h2>
                    <p class="section-desc">Ïû¨Îã®Ìï† ÏõêÌåê ÏÇ¨Ïù¥Ï¶àÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</p>

                    <div class="input-display board-input-row">
                        <div class="input-field-wrap" data-board-field="boardWidth">
                            <div class="input-field-mini">
                                <span class="field-val" id="displayBoardWidth">2440</span>
                                <span class="field-unit">mm</span>
                            </div>
                            <label class="field-lbl">Í∞ÄÎ°ú</label>
                        </div>
                        <div class="input-sep">√ó</div>
                        <div class="input-field-wrap" data-board-field="boardHeight">
                            <div class="input-field-mini">
                                <span class="field-val" id="displayBoardHeight">1220</span>
                                <span class="field-unit">mm</span>
                            </div>
                            <label class="field-lbl">ÏÑ∏Î°ú</label>
                        </div>
                    </div>

                    <!-- Grain Consideration Toggle -->
                    <div class="grain-setting-card" id="boardGrainToggle">
                        <div class="grain-info">
                            <span class="grain-icon">üåæ</span>
                            <div class="grain-text">
                                <span class="grain-title">Í≤∞Í≥†Î†§</span>
                                <span class="grain-sub">ÎÇòÎ¨¥Í≤∞ Î∞©Ìñ• ÎßûÏ∂∞ Î∞∞Ïπò</span>
                            </div>
                        </div>
                        <div class="toggle-switch">
                            <input type="checkbox" id="boardRotatable" checked>
                            <span class="slider"></span>
                        </div>
                    </div>

                    <!-- Visual Preview of Board -->
                    <div class="board-preview-area">
                        <div class="board-canvas-mini" id="boardPreview">
                            <div class="grain-pattern"></div>
                            <div class="board-label">ÏûêÏú† ÌöåÏ†Ñ</div>
                        </div>
                    </div>
                </div>

                <!-- Hidden inputs for logic compatibility -->
                <input type="number" id="boardWidth" value="2440" class="hidden">
                <input type="number" id="boardHeight" value="1220" class="hidden">
                <input type="number" id="boardThickness" value="18" class="hidden">
                <input type="number" id="kerfInput" value="4" class="hidden">
            </div>

            <footer class="screen-footer">
                <button class="btn btn-primary btn-lg" id="toStep2Btn">Îã§Ïùå: Î∂ÄÌíà ÏûÖÎ†• ‚Üí</button>
            </footer>
        </section>

        <!-- Step 2: Parts Input -->
        <section class="screen" id="step2">
            <div class="screen-content fixed-layout">
                <header class="screen-header-simple">
                    <h2 class="screen-title-small">Ï†àÎã® ÏûÖÎ†•</h2>
                    <div class="parts-count-badge" id="partsCount">Ï†àÎã® 0Í∞ú</div>
                </header>

                <!-- Expanded Parts List (Dominant Area) -->
                <div class="parts-section-expanded">
                    <div class="parts-header-mini">
                        <span class="section-lbl">Î™©Î°ù</span>
                        <button class="link-btn-danger" id="clearAllBtn">Ï†ÑÏ≤¥ÏÇ≠Ï†ú</button>
                    </div>
                    <div class="parts-list-scroll" id="partsList">
                        <!-- Dynamic parts -->
                    </div>
                </div>

                <!-- Run Optimization (Floating above input bar) -->
                <div class="calculate-action-area">
                    <button class="btn btn-calculate-main" id="calculateBtn">ÏµúÏ†ÅÌôî Ïã§Ìñâ</button>
                </div>
            </div>

            <!-- FIXED BOTTOM INPUT BAR -->
            <div class="bottom-input-bar">
                <div class="input-row-fixed">
                    <!-- Width Input -->
                    <div class="input-box-compact" data-field="width">
                        <span class="box-label">Í∞ÄÎ°ú</span>
                        <span class="box-value" id="inputWidth">800</span>
                        <span class="box-unit">mm</span>
                    </div>

                    <div class="input-separator-x">√ó</div>

                    <!-- Height Input -->
                    <div class="input-box-compact" data-field="height">
                        <span class="box-label">ÏÑ∏Î°ú</span>
                        <span class="box-value" id="inputHeight">400</span>
                        <span class="box-unit">mm</span>
                    </div>

                    <div class="input-separator-x">√ó</div>

                    <!-- Vertical Stepper -->
                    <div class="vertical-stepper">
                        <button class="v-step-btn plus" onclick="app.changeQty(1)">+</button>
                        <div class="v-step-value" id="displayQty">1</div>
                        <button class="v-step-btn minus" onclick="app.changeQty(-1)">‚àí</button>
                    </div>

                    <!-- Grain Toggle Card -->
                    <div class="grain-toggle-icon" id="grainToggle">
                        <div class="grain-icon-box">
                            <div class="grain-pattern-mini"></div>
                        </div>
                        <span class="grain-label-tiny">Í≤∞ Í≥†Ï†ï</span>
                    </div>

                    <!-- Add Button -->
                    <button class="btn btn-add-compact" id="addPartBtn">+</button>
                </div>
            </div>

            <!-- Hidden inputs remain for logic compatibility -->
            <input type="checkbox" id="partRotatable" checked class="hidden">
        </section>

        <!-- Custom Keypad (Popup Style) -->
        <div class="keypad-popup-overlay hidden" id="keypadOverlay">
            <div class="keypad-popup">
                <!-- Large Input Display Area -->
                <div class="keypad-display-section">
                    <div class="keypad-field-name" id="keypadFieldLabel">Í∞ÄÎ°ú</div>
                    <div class="keypad-large-value">
                        <span id="keypadPreview">0</span><span class="unit">mm</span>
                    </div>
                </div>

                <div class="keypad-grid">
                    <button class="key" data-key="1">1</button>
                    <button class="key" data-key="2">2</button>
                    <button class="key" data-key="3">3</button>
                    <button class="key" data-key="4">4</button>
                    <button class="key" data-key="5">5</button>
                    <button class="key" data-key="6">6</button>
                    <button class="key" data-key="7">7</button>
                    <button class="key" data-key="8">8</button>
                    <button class="key" data-key="9">9</button>
                    <button class="key key-back" data-key="‚Üê">‚Üê</button>
                    <button class="key" data-key="0">0</button>
                    <button class="key key-confirm" data-key="done">‚úì</button>
                </div>
            </div>
        </div>

        <!-- Step 3: Optimization Results -->
        <section class="screen" id="step3">
            <!-- Icon Summary Bar -->
            <div class="result-summary-bar">
                <div class="summary-item">
                    <span class="icon">üí∞</span>
                    <span class="value" id="resCost">0Ïõê</span>
                </div>
                <div class="summary-item">
                    <span class="icon">‚úÇÔ∏è</span>
                    <span class="value" id="resCuts">0Ìöå</span>
                </div>
                <div class="summary-item">
                    <span class="icon">üì¶</span>
                    <span class="value" id="resBoards">0Ïû•</span>
                </div>
            </div>

            <div class="screen-content scrollable">
                <!-- Layout Canvas Area -->
                <div class="canvas-container-wrap">
                    <div class="canvas-header">
                        <button class="nav-arrow" id="prevBoard">‚óÄ</button>
                        <div class="board-info">
                            <span class="board-page" id="boardPage">1/1</span>
                            <span class="board-eff" id="boardEfficiency">Ìö®Ïú® 0.0%</span>
                        </div>
                        <button class="nav-arrow" id="nextBoard">‚ñ∂</button>
                    </div>
                    <div id="canvas-container"></div>
                </div>

                <!-- Navigation Grid Buttons -->
                <div class="result-actions-grid">
                    <button class="btn btn-outline" id="backToInputBtn">‚Üê Îã§ÏãúÏûÖÎ†•</button>
                    <button class="btn btn-outline" id="homeBtn">üè† ÏÉàÏûëÏóÖ</button>
                    <button class="btn btn-outline" id="viewPdfBtn">üìÑ PDFÎ≥¥Í∏∞</button>
                </div>

                <button class="btn btn-primary btn-share-main" id="shareBtn">üì§ Í≥µÏú†ÌïòÍ∏∞</button>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script src="js/packer.js"></script>
    <script src="js/renderer.js"></script>
    <script src="js/app.js"></script>
</body>

</html>